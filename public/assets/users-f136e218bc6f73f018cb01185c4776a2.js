(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.controllers||(pi.controllers={}),pi.controllers.UsersEdit=function(_super){function UsersEdit(){this._scope=new pi.utils.Scope,UsersEdit.__super__.constructor.call(this,"users")}return __extends(UsersEdit,_super),UsersEdit.prototype.destroy=function(){return!1},UsersEdit.prototype.save=function(){return!1},UsersEdit.prototype.cancel=function(){return this.view.leftbar.one("hidden",function(_this){return function(){return _this.switch_to("main")}}(this)),this.view.close()},UsersEdit.prototype.switched_from_main=function(){return this.view["new"](),!0},UsersEdit.include(pi.modules.Search),UsersEdit}(pi.controllers.Base)}(this)}).call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.controllers||(pi.controllers={}),pi.controllers.Users=function(_super){function Users(){Users.__super__.constructor.call(this,"users","main")}return __extends(Users,_super),Users.prototype.initialize=function(){return Users.__super__.initialize.call(this,new pi.views.UsersView)},Users.prototype.destroy=function(){return!0},Users.prototype.edit=function(data){return this.goto(this._path("edit",data)[0],"_self")},Users.prototype.search=function(q){return this.view.search(q)},Users.prototype.sort=function(params){return this.view.sort(params)},Users}(pi.controllers.Base)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.controllers||(pi.controllers={}),pi.controllers.UsersSelect=function(_super){function UsersSelect(){this._scope=new pi.utils.Scope(null,["page"],{q:function(prev,query){var _ref;return 0===(null!=(_ref=query.match(prev))?_ref.index:void 0)?prev||"":!1}}),UsersSelect.__super__.constructor.call(this,"users")}return __extends(UsersSelect,_super),UsersSelect.prototype.initialize=function(){return UsersSelect.__super__.initialize.apply(this,arguments),after(3e3,function(_this){return function(){return _this.index()}}(this))},UsersSelect.prototype.cancel=function(){return this.view.close().then(function(_this){return function(){return _this.view.reset(),_this.exit()}}(this))},UsersSelect.prototype.select_users=function(){var item,_i,_item,_len,_ref,_selected;for(_selected=[],_ref=this.view.list.selected(),_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],_item=utils.clone(item,["nod","selected","disabled","role","role_name"]),_item.changed=1,_selected.push(_item);return this.view.close().then(function(_this){return function(){return _this.exit({users:_selected})}}(this))},UsersSelect.prototype.switched_from_any=function(data){return this.view["new"](null!=data?data.users:void 0)},UsersSelect.include(pi.modules.Paginated,pi.modules.Search),UsersSelect}(pi.controllers.Base)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.views||(pi.views={}),pi.views.UsersEditView=function(_super){function UsersEditView(){UsersEditView.__super__.constructor.call(this,[{list:"add_users_list"}],null)}return __extends(UsersEditView,_super),UsersEditView.prototype.initialize=function(){return UsersEditView.__super__.initialize.apply(this,arguments)},UsersEditView.prototype["new"]=function(){return this._show()},UsersEditView.prototype.edit=function(){return!1},UsersEditView.prototype.destroy=function(){return!1},UsersEditView.prototype.clear=function(){return UsersEditView.__super__.clear.apply(this,arguments),this.form.clear()},UsersEditView.prototype.close=function(){return this.leftbar.hide()},UsersEditView.prototype._show=function(){return this.leftbar.one("hidden",function(_this){return function(){return after(500,function(){return _this.clear()})}}(this)),this.leftbar.show()},UsersEditView}(pi.views.CommonListView)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.views||(pi.views={}),pi.views.UsersView=function(_super){function UsersView(){UsersView.__super__.constructor.call(this,[{list:"users_list"},"loader","show_user_popup","new_user_popup","show_user_form",{confirm:"confirm_modal"}])}return __extends(UsersView,_super),UsersView.prototype.render_list_data=function(data){var user,_i,_len,_ref;for(_ref=data.users,_i=0,_len=_ref.length;_len>_i;_i++)user=_ref[_i],this.list.add_item(user,!1);return this.list.update()},UsersView.prototype.show=function(data){return this.popup.open(this.show_user_popup,{align:!1}),this.show_user_form.data(data),this.show_user_list.data_provider(data.participants)},UsersView.prototype["new"]=function(){return this.popup.open(this.new_user_popup)},UsersView}(pi.views.CommonListView)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.views||(pi.views={}),pi.views.UsersSelectView=function(_super){function UsersSelectView(){UsersSelectView.__super__.constructor.call(this,[{list:"users_select_list"},{loader:"users_select_loader"},{nod:"select_users_popup"},{search_field:"users_search"}],null)}return __extends(UsersSelectView,_super),UsersSelectView.prototype.initialize=function(){return UsersSelectView.__super__.initialize.apply(this,arguments),this.list._create_item=this._list_create_item},UsersSelectView.prototype._list_create_item=function(data){var item,_ref;return item=pi.List.prototype._create_item.call(this,data),null!=this._disabled_ids&&(_ref=item.id,__indexOf.call(this._disabled_ids,_ref)>=0)&&this.selectable.disable_item(item),item},UsersSelectView.prototype["new"]=function(users){var item,user,_i,_len,_ref,_ref1;if(this.list._disabled_ids=null!=users?function(){var _i,_len,_results;for(_results=[],_i=0,_len=users.length;_len>_i;_i++)user=users[_i],_results.push(user.id);return _results}():null,null!=this.list._disabled_ids)for(_ref=this.list.items,_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],_ref1=item.id,__indexOf.call(this.list._disabled_ids,_ref1)>=0&&this.list.selectable.disable_item(item);return this._show()},UsersSelectView.prototype.clear=function(){return UsersSelectView.__super__.clear.apply(this,arguments)},UsersSelectView.prototype.close=function(){return this.popup.close()},UsersSelectView.prototype.reset=function(){var item,_i,_len,_ref;for(_ref=this.list.items,_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],this.list.selectable.enable_item(item);return this.list.clear_selection(),this.search_field.reset()},UsersSelectView.prototype.render_list_data=function(data){var user,_i,_len,_ref;for(_ref=data.users,_i=0,_len=_ref.length;_len>_i;_i++)user=_ref[_i],this.list.add_item(user,!1);return this.list.update()},UsersSelectView.prototype._show=function(){return this.popup.open(this.nod,{align:!1,close:"@@cancel"})},UsersSelectView}(pi.views.CommonListView)}(this)}.call(this);