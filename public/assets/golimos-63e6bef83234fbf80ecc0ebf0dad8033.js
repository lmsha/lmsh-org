(function(){var t={}.hasOwnProperty,r=function(r,o){function n(){this.constructor=r}for(var e in o)t.call(o,e)&&(r[e]=o[e]);return n.prototype=o.prototype,r.prototype=new n,r.__super__=o.prototype,r};!function(t){"use strict";var o,n;return o=t.pi=t.pi||{},n=o.utils,o.controllers||(o.controllers={}),o.controllers.AddTaskGolimos=function(t){function n(){this._scope=new o.utils.Scope,n.__super__.constructor.call(this,"golimos")}return r(n,t),n.prototype.destroy=function(){return!1},n.prototype.create_task=function(t){return null!=t?o.net.post("/golimos/"+t.id+"/buy_task",t).then(function(t){return function(r){return t.view.task_assigned(r.task)}}(this))["catch"](function(t){return function(r){return t.view.error(r.message)}}(this)):void 0},n.prototype.close=function(){return this.view.popup.close().then(function(t){return function(){return t.exit()}}(this))},n.prototype.switched_from_main=function(t){return this.view.popup.open(this.view.add_task_popup,{align:!1,close:function(t){return function(){return t.close()}}(this)}),this.view.show(t),!0},n}(o.controllers.Base)}(this)}).call(this),function(){var t={}.hasOwnProperty,r=function(r,o){function n(){this.constructor=r}for(var e in o)t.call(o,e)&&(r[e]=o[e]);return n.prototype=o.prototype,r.prototype=new n,r.__super__=o.prototype,r};!function(t){"use strict";var o,n;return o=t.pi=t.pi||{},n=o.utils,o.controllers||(o.controllers={}),o.controllers.Golimos=function(t){function n(){this._scope=new o.utils.Scope,n.__super__.constructor.call(this,"golimos","main",{add_task:new o.controllers.AddTaskGolimos,submit_task:new o.controllers.SubmitTaskGolimos})}return r(n,t),n.prototype.destroy=function(){return!0},n.prototype.add_task=function(t){return null!=t?this.switch_to("add_task",t):void 0},n.prototype.submit_task=function(t){return null!=t?o.net.get("/golimos/"+t.id+"/current_task").then(function(r){return function(o){var n;return n=o.task,t.task_id=n.id,t.task_name=""+n.category+" \u2116"+n.number+" ("+n.form+")",r.switch_to("submit_task",t)}}(this))["catch"](function(t){return function(r){return t.view.error(r.message)}}(this)):void 0},n.prototype.edit=function(t){return this.goto(this._path("edit",t)[0],"_self")},n.prototype.search=function(t){return this.view.search(t)},n.prototype.sort=function(t){return this.view.sort(t)},n}(o.controllers.Base)}(this)}.call(this),function(){var t={}.hasOwnProperty,r=function(r,o){function n(){this.constructor=r}for(var e in o)t.call(o,e)&&(r[e]=o[e]);return n.prototype=o.prototype,r.prototype=new n,r.__super__=o.prototype,r};!function(t){"use strict";var o,n;return o=t.pi=t.pi||{},n=o.utils,o.controllers||(o.controllers={}),o.controllers.SubmitTaskGolimos=function(t){function n(){this._scope=new o.utils.Scope,n.__super__.constructor.call(this,"golimos")}return r(n,t),n.prototype.destroy=function(){return!1},n.prototype.save=function(){return!1},n.prototype.close=function(){return this.view.popup.close().then(function(t){return function(){return t.exit()}}(this))},n.prototype.submit_task=function(t){return null!=t?o.net.post("/golimos/"+t.id+"/submit_task",t).then(function(t){return function(r){return t.view.task_submited(r)}}(this))["catch"](function(t){return function(r){return t.view.error(r.message)}}(this)):void 0},n.prototype.decline_task=function(t){return null!=t?o.net.post("/golimos/"+t.id+"/decline_task",t).then(function(t){return function(r){return t.view.task_declined(r)}}(this))["catch"](function(t){return function(r){return t.view.error(r.message)}}(this)):void 0},n.prototype.switched_from_main=function(t){return this.view.popup.open(this.view.submit_task_popup,{align:!1,close:function(t){return function(){return t.close()}}(this)}),this.view.show(t),!0},n}(o.controllers.Base)}(this)}.call(this),function(){var t={}.hasOwnProperty,r=function(r,o){function n(){this.constructor=r}for(var e in o)t.call(o,e)&&(r[e]=o[e]);return n.prototype=o.prototype,r.prototype=new n,r.__super__=o.prototype,r};!function(t){"use strict";var o,n;return o=t.pi=t.pi||{},n=o.utils,o.views||(o.views={}),o.views.GolimosAddTaskView=function(t){function o(){o.__super__.constructor.call(this,[{loader:"add_task_loader"},{form:"add_task_form"},"add_task_popup",{message:"add_task_message"},{btn:"add_task_btn"}])}return r(o,t),o.prototype.show=function(t){return this.message.html(""),this.btn.enable(),this.form.value(t)},o.prototype.task_assigned=function(t){return this.btn.disable(),this.message.html("<p>\u0412\u044b \u043a\u0443\u043f\u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0443:</p><p>"+t.category+" \u2116"+t.number+" ("+t.form+")</p><p>\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c: "+t.value+"</p>")},o}(o.views.Base)}(this)}.call(this),function(){var t={}.hasOwnProperty,r=function(r,o){function n(){this.constructor=r}for(var e in o)t.call(o,e)&&(r[e]=o[e]);return n.prototype=o.prototype,r.prototype=new n,r.__super__=o.prototype,r};!function(t){"use strict";var o,n;return o=t.pi=t.pi||{},n=o.utils,o.views||(o.views={}),o.views.GolimosView=function(t){function e(){e.__super__.constructor.call(this,[{list:"users_list"},"loader","show_user_popup","new_user_popup","show_user_form",{confirm:"confirm_modal"}])}return r(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),o.client.subscribe("/event",function(t){return function(r){return n.debug(r),"user"===r.event?t.redraw_user(r.data):void 0}}(this))},e.prototype.render_list_data=function(t){var r,o,n,e;for(e=t.golimos,o=0,n=e.length;n>o;o++)r=e[o],this.list.add_item(r,!1);return this.list.update()},e.prototype.redraw_user=function(t){var r,o;try{return o=this.list.where({id:t.id})[0],this.list.redraw_item(o,t),this.list.clear_selection()}catch(e){return r=e,n.error(r)}},e.prototype.show=function(t){return this.popup.open(this.show_user_popup,{align:!1}),this.show_user_form.data(t),this.show_user_list.data_provider(t.participants)},e.prototype["new"]=function(){return this.popup.open(this.new_user_popup)},e}(o.views.CommonListView)}(this)}.call(this),function(){var t={}.hasOwnProperty,r=function(r,o){function n(){this.constructor=r}for(var e in o)t.call(o,e)&&(r[e]=o[e]);return n.prototype=o.prototype,r.prototype=new n,r.__super__=o.prototype,r};!function(t){"use strict";var o,n;return o=t.pi=t.pi||{},n=o.utils,o.views||(o.views={}),o.views.GolimosSubmitTaskView=function(t){function o(){o.__super__.constructor.call(this,[{loader:"submit_task_loader"},{form:"submit_task_form"},{message:"submit_task_message"},"submit_task_popup","submit_task_btns"])}return r(o,t),o.prototype.show=function(t){return this.message.html(""),this.submit_task_btns.enable(),this.form.value(t)},o.prototype.task_submited=function(t){return this.submit_task_btns.disable(),this.message.html("<p>\u0412\u044b \u043f\u0440\u043e\u0434\u0430\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0443 \u0437\u0430 "+t.score+"</p>")},o.prototype.task_declined=function(){return this.submit_task_btns.disable(),this.status_success.show("\u0417\u0430\u0434\u0430\u0447\u0430 \u0441\u043d\u044f\u0442\u0430")},o}(o.views.Base)}(this)}.call(this);