(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.controllers||(pi.controllers={}),pi.controllers.AddTaskGolimos=function(_super){function AddTaskGolimos(){this._scope=new pi.utils.Scope,AddTaskGolimos.__super__.constructor.call(this,"golimos")}return __extends(AddTaskGolimos,_super),AddTaskGolimos.prototype.initialize=function(){return AddTaskGolimos.__super__.initialize.call(this,new pi.views.GolimosAddTaskView)},AddTaskGolimos.prototype.destroy=function(){return!1},AddTaskGolimos.prototype.create_task=function(data){return null!=data?pi.net.post("/golimos/"+data.id+"/buy_task",data).then(function(_this){return function(response){return _this.view.task_assigned(response.task)}}(this))["catch"](function(_this){return function(e){return _this.view.error(e.message)}}(this)):void 0},AddTaskGolimos.prototype.close=function(){return this.view.popup.close().then(function(_this){return function(){return _this.exit()}}(this))},AddTaskGolimos.prototype.switched_from_main=function(data){return this.view.popup.open(this.view.add_task_popup,{align:!1,close:function(_this){return function(){return _this.close()}}(this)}),this.view.show(data),!0},AddTaskGolimos}(pi.controllers.Base)}(this)}).call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.controllers||(pi.controllers={}),pi.controllers.Golimos=function(_super){function Golimos(){this._scope=new pi.utils.Scope,Golimos.__super__.constructor.call(this,"golimos","main",{add_task:new pi.controllers.AddTaskGolimos,submit_task:new pi.controllers.SubmitTaskGolimos})}return __extends(Golimos,_super),Golimos.prototype.initialize=function(){return Golimos.__super__.initialize.call(this,new pi.views.GolimosView)},Golimos.prototype.destroy=function(){return!0},Golimos.prototype.add_task=function(data){return null!=data?this.switch_to("add_task",data):void 0},Golimos.prototype.submit_task=function(data){return null!=data?pi.net.get("/golimos/"+data.id+"/current_task").then(function(_this){return function(response){var task;return task=response.task,data.task_id=task.id,data.task_name=""+task.category+" \u2116"+task.number+" ("+task.form+")",_this.switch_to("submit_task",data)}}(this))["catch"](function(_this){return function(e){return _this.view.error(e.message)}}(this)):void 0},Golimos.prototype.edit=function(data){return this.goto(this._path("edit",data)[0],"_self")},Golimos.prototype.search=function(q){return this.view.search(q)},Golimos.prototype.sort=function(params){return this.view.sort(params)},Golimos}(pi.controllers.Base)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.controllers||(pi.controllers={}),pi.controllers.SubmitTaskGolimos=function(_super){function SubmitTaskGolimos(){this._scope=new pi.utils.Scope,SubmitTaskGolimos.__super__.constructor.call(this,"golimos")}return __extends(SubmitTaskGolimos,_super),SubmitTaskGolimos.prototype.initialize=function(){return SubmitTaskGolimos.__super__.initialize.call(this,new pi.views.GolimosSubmitTaskView)},SubmitTaskGolimos.prototype.destroy=function(){return!1},SubmitTaskGolimos.prototype.save=function(){return!1},SubmitTaskGolimos.prototype.close=function(){return this.view.popup.close().then(function(_this){return function(){return _this.exit()}}(this))},SubmitTaskGolimos.prototype.submit_task=function(data){return null!=data?pi.net.post("/golimos/"+data.id+"/submit_task",data).then(function(_this){return function(response){return _this.view.task_submited(response)}}(this))["catch"](function(_this){return function(e){return _this.view.error(e.message)}}(this)):void 0},SubmitTaskGolimos.prototype.decline_task=function(data){return null!=data?pi.net.post("/golimos/"+data.id+"/decline_task",data).then(function(_this){return function(response){return _this.view.task_declined(response)}}(this))["catch"](function(_this){return function(e){return _this.view.error(e.message)}}(this)):void 0},SubmitTaskGolimos.prototype.switched_from_main=function(data){return this.view.popup.open(this.view.submit_task_popup,{align:!1,close:function(_this){return function(){return _this.close()}}(this)}),this.view.show(data),!0},SubmitTaskGolimos}(pi.controllers.Base)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.views||(pi.views={}),pi.views.GolimosAddTaskView=function(_super){function GolimosAddTaskView(){GolimosAddTaskView.__super__.constructor.call(this,[{loader:"add_task_loader"},{form:"add_task_form"},"add_task_popup",{message:"add_task_message"},{btn:"add_task_btn"}])}return __extends(GolimosAddTaskView,_super),GolimosAddTaskView.prototype.show=function(data){return this.message.html(""),this.btn.enable(),this.form.value(data)},GolimosAddTaskView.prototype.task_assigned=function(data){return this.btn.disable(),this.message.html("<p>\u0412\u044b \u043a\u0443\u043f\u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0443:</p><p>"+data.category+" \u2116"+data.number+" ("+data.form+")</p><p>\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c: "+data.value+"</p>")},GolimosAddTaskView}(pi.views.Base)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.views||(pi.views={}),pi.views.GolimosView=function(_super){function GolimosView(){GolimosView.__super__.constructor.call(this,[{list:"users_list"},"loader","show_user_popup","new_user_popup","show_user_form",{confirm:"confirm_modal"}])}return __extends(GolimosView,_super),GolimosView.prototype.initialize=function(){return GolimosView.__super__.initialize.apply(this,arguments),pi.client.subscribe("/event",function(_this){return function(payload){return utils.debug(payload),"user"===payload.event?_this.redraw_user(payload.data):void 0}}(this))},GolimosView.prototype.render_list_data=function(data){var user,_i,_len,_ref;for(_ref=data.golimos,_i=0,_len=_ref.length;_len>_i;_i++)user=_ref[_i],this.list.add_item(user,!1);return this.list.update()},GolimosView.prototype.redraw_user=function(data){var e,item;try{return item=this.list.where({id:data.id})[0],this.list.redraw_item(item,data),this.list.clear_selection()}catch(_error){return e=_error,utils.error(e)}},GolimosView.prototype.show=function(data){return this.popup.open(this.show_user_popup,{align:!1}),this.show_user_form.data(data),this.show_user_list.data_provider(data.participants)},GolimosView.prototype["new"]=function(){return this.popup.open(this.new_user_popup)},GolimosView}(pi.views.CommonListView)}(this)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(context){"use strict";var pi,utils;return pi=context.pi=context.pi||{},utils=pi.utils,pi.views||(pi.views={}),pi.views.GolimosSubmitTaskView=function(_super){function GolimosSubmitTaskView(){GolimosSubmitTaskView.__super__.constructor.call(this,[{loader:"submit_task_loader"},{form:"submit_task_form"},{message:"submit_task_message"},"submit_task_popup","submit_task_btns"])}return __extends(GolimosSubmitTaskView,_super),GolimosSubmitTaskView.prototype.show=function(data){return this.message.html(""),this.submit_task_btns.enable(),this.form.value(data)},GolimosSubmitTaskView.prototype.task_submited=function(data){return this.submit_task_btns.disable(),this.message.html("<p>\u0412\u044b \u043f\u0440\u043e\u0434\u0430\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0443 \u0437\u0430 "+data.score+"</p>")},GolimosSubmitTaskView.prototype.task_declined=function(){return this.submit_task_btns.disable(),this.status_success.show("\u0417\u0430\u0434\u0430\u0447\u0430 \u0441\u043d\u044f\u0442\u0430")},GolimosSubmitTaskView}(pi.views.Base)}(this)}.call(this);